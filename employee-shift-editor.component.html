<div class="employee-shift-editor">
    <!-- Search Section -->
    <nz-card nzTitle="Tìm kiếm nhân viên" class="search-card">
        <nz-row [nzGutter]="16" nzAlign="middle">
            <nz-col [nzSpan]="8">
                <nz-input [(ngModel)]="employeeCode" placeholder="Nhập mã nhân viên" nzSize="large"
                    (keyup.enter)="searchEmployee()">
                    <ng-template nzPrefix>
                        <span nz-icon nzType="user" nzTheme="outline"></span>
                    </ng-template>
                </nz-input>
            </nz-col>
            <nz-col [nzSpan]="4">
                <button nz-button nzType="primary" nzSize="large" (click)="searchEmployee()" [nzLoading]="isLoading">
                    <span nz-icon nzType="search"></span>
                    Tìm kiếm
                </button>
            </nz-col>
            <nz-col [nzSpan]="12" *ngIf="employeeData">
                <div class="employee-info">
                    <h4>
                        <span nz-icon nzType="user" nzTheme="outline"></span>
                        {{ employeeData.fullName }} ({{ employeeData.code }})
                    </h4>
                    <p>
                        <strong>Nhóm:</strong> {{ employeeData.group }} |
                        <strong>Ca:</strong> {{ employeeData.shift }} |
                        <strong>Cấp bậc:</strong> {{ employeeData.grade }}
                    </p>
                </div>
            </nz-col>
        </nz-row>
    </nz-card>

    <!-- Data Table Section -->
    <nz-card *ngIf="employeeData && shiftRecords.length > 0" [nzTitle]="tableTitle" class="data-card">
        <ng-template #tableTitle>
            <div class="table-header">
                <h3>Lịch làm việc tháng {{ selectedMonth }}</h3>
                <div class="table-actions">
                    <button nz-button nzType="default" (click)="selectAllModified()" [disabled]="modifiedCount === 0">
                        <span nz-icon nzType="check-square"></span>
                        Chọn tất cả thay đổi ({{ modifiedCount }})
                    </button>
                    <button nz-button nzType="default" (click)="clearSelection()" [disabled]="selectedCount === 0">
                        <span nz-icon nzType="close-square"></span>
                        Bỏ chọn tất cả
                    </button>
                    <button nz-button nzType="primary" (click)="saveChanges()" [disabled]="selectedCount === 0"
                        [nzLoading]="isLoading">
                        <span nz-icon nzType="save"></span>
                        Lưu thay đổi ({{ selectedCount }})
                    </button>
                </div>
            </div>
        </ng-template>

        <!-- Statistics -->
        <div class="statistics-row" *ngIf="shiftRecords.length > 0">
            <nz-row [nzGutter]="16">
                <nz-col [nzSpan]="6">
                    <div class="stat-item">
                        <span class="stat-label">Tổng số ngày:</span>
                        <span class="stat-value">{{ shiftRecords.length }}</span>
                    </div>
                </nz-col>
                <nz-col [nzSpan]="6">
                    <div class="stat-item">
                        <span class="stat-label">Số thay đổi:</span>
                        <span class="stat-value modified">{{ modifiedCount }}</span>
                    </div>
                </nz-col>
                <nz-col [nzSpan]="6">
                    <div class="stat-item">
                        <span class="stat-label">Đã chọn:</span>
                        <span class="stat-value selected">{{ selectedCount }}</span>
                    </div>
                </nz-col>
                <nz-col [nzSpan]="6">
                    <div class="stat-item">
                        <span class="stat-label">Tháng:</span>
                        <span class="stat-value">{{ selectedMonth }}/{{ currentYear }}</span>
                    </div>
                </nz-col>
            </nz-row>
        </div>

        <!-- Data Table -->
        <nz-table #shiftTable [nzData]="shiftRecords" [nzSize]="'middle'" [nzPageSize]="31" [nzShowPagination]="false"
            [nzScroll]="{ y: '500px' }" [nzLoading]="isLoading">
            <thead>
                <tr>
                    <th nzWidth="60px">
                        <label nz-checkbox [nzDisabled]="true">Check</label>
                    </th>
                    <th nzWidth="60px">STT</th>
                    <th nzWidth="120px">Ngày</th>
                    <th nzWidth="200px">Họ và Tên</th>
                    <th nzWidth="100px">Group</th>
                    <th nzWidth="80px">Ca làm việc</th>
                    <th nzWidth="250px">Loại ca</th>
                    <th>Trạng thái</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let record of shiftRecords; let i = index" [class.modified-row]="record.isModified"
                    [class.selected-row]="record.checked">
                    <td>
                        <label nz-checkbox [(ngModel)]="record.checked" (ngModelChange)="onCheckboxChange(record)"
                            [nzDisabled]="!record.isModified"></label>
                    </td>
                    <td>{{ i + 1 }}</td>
                    <td>{{ formatDate(record.date) }}</td>
                    <td>{{ record.fullName }}</td>
                    <td>{{ record.group }}</td>
                    <td>{{ record.shift }}</td>
                    <td>
                        <nz-select [(ngModel)]="record.shiftType" (ngModelChange)="onShiftTypeChange(record)"
                            nzSize="small" class="shift-type-select" [class.modified-select]="record.isModified">
                            <nz-option *ngFor="let option of shiftTypeOptions" [nzLabel]="option.label"
                                [nzValue]="option.value"></nz-option>
                        </nz-select>
                    </td>
                    <td>
                        <span *ngIf="record.isModified" nz-tag nzColor="orange" class="status-tag">
                            <span nz-icon nzType="edit" nzTheme="outline"></span>
                            Đã thay đổi
                        </span>
                        <span *ngIf="record.checked" nz-tag nzColor="green" class="status-tag">
                            <span nz-icon nzType="check" nzTheme="outline"></span>
                            Đã chọn
                        </span>
                        <span *ngIf="!record.isModified && !record.checked" nz-tag nzColor="default" class="status-tag">
                            <span nz-icon nzType="minus" nzTheme="outline"></span>
                            Không thay đổi
                        </span>
                    </td>
                </tr>
            </tbody>
        </nz-table>
    </nz-card>

    <!-- No Data Message -->
    <nz-card *ngIf="!employeeData && !isLoading" class="no-data-card">
        <div class="no-data-content">
            <span nz-icon nzType="user-add" nzTheme="outline" class="no-data-icon"></span>
            <h3>Nhập mã nhân viên để xem lịch làm việc</h3>
            <p>Vui lòng nhập mã nhân viên vào ô tìm kiếm bên trên để hiển thị lịch làm việc trong tháng.</p>
        </div>
    </nz-card>

    <!-- Loading Spinner -->
    <div *ngIf="isLoading" class="loading-container">
        <nz-spin nzSize="large">
            <ng-template #nzIndicator>
                <span nz-icon nzType="loading" style="font-size: 24px;"></span>
            </ng-template>
        </nz-spin>
    </div>
</div>